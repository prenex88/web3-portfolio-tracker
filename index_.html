<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web3 Portfolio Tracker Pro - Cloud Edition</title>
    
    <!-- Manifest fÃ¼r PWA-Funktionen -->
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiV2ViMyBQb3J0Zm9saW8gVHJhY2tlciBQcm8iLCJzaG9ydF9uYW1lIjoiUG9ydGZvbGlvIFRyYWNrZXIiLCJzdGFydF91cmwiOiIvIiwiZGlzcGxheSI6InN0YW5kYWxvbmUiLCJiYWNrZ3JvdW5kX2NvbG9yIjoiIzY2N2VlYSIsInRoZW1lX2NvbG9yIjoiIzY2N2VlYSIsImljb25zIjpbeyJzcmMiOiJkYXRhOmltYWdlL3N2Zyt4bWwsPHN2ZyB4bWxucz0lMjJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyUyMiB2aWV3Qm94PSUyMjAgMCAxMDAgMTAwJTIyPjx0ZXh0IHk9JTIyLjllbSUyMiBmb250LXNpemU=JTIyOTAlMjI+8J+agDwvdGV4dD48L3N2Zz4iLCJzaXplcyI6IjE5MngxOTIiLCJ0eXBlIjoiaW1hZ2Uvc3ZnK3htbCJ9XX0=">
    <meta name="theme-color" content="#6366f1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    
    <!-- Externe Bibliotheken -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><defs><linearGradient id='g' x1='0%25' y1='0%25' x2='100%25' y2='100%25'><stop offset='0%25' stop-color='%236366f1'/><stop offset='100%25' stop-color='%23764ba2'/></linearGradient></defs><circle cx='50' cy='50' r='45' fill='url(%23g)'/><text x='50' y='65' text-anchor='middle' font-size='40' fill='white'>ğŸš€</text></svg>">
    
    <!-- Verweis auf die CSS-Datei -->
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <!-- Biometrische Authentifizierung Overlay -->
    <div id="biometricOverlay" class="biometric-overlay">
        <div class="biometric-content">
            <div class="biometric-icon">ğŸ”</div>
            <div class="biometric-text">Portfolio Tracker entsperren</div>
            <div class="biometric-subtitle">Verwenden Sie Ihren Fingerabdruck oder Face ID</div>
            <button class="biometric-fallback" onclick="bypassBiometric()">
                Ohne Authentifizierung fortfahren
            </button>
        </div>
    </div>

    <!-- Quick Actions Bar -->
    <div id="quickActionsBar" class="quick-actions-bar">
        <button class="quick-action-btn" onclick="quickSave()" title="Quick Save (Ctrl+S)">ğŸ’¾</button>
        <button class="quick-action-btn" onclick="quickSync()" title="Quick Sync">â˜ï¸</button>
        <button class="quick-action-btn" onclick="switchTab('entry')" title="New Entry">ğŸ“</button>
        <button class="quick-action-btn" onclick="toggleQuickActions()" title="Hide">âœ•</button>
    </div>

    <!-- Sync Status Leiste -->
    <div id="syncStatusBar" class="sync-status-bar">
        <div class="sync-status">
            <div id="syncIndicator" class="sync-indicator offline"></div>
            <span id="syncStatusText">Offline Modus</span>
            <span id="lastSyncTime" style="color: var(--text-secondary); font-size: 12px;"></span>
        </div>
        <div class="sync-actions">
            <button id="syncNowBtn" class="btn btn-primary btn-small" onclick="syncNow()">
                <span id="syncBtnIcon">â˜ï¸</span>
                <span id="syncBtnText">Sync</span>
            </button>
            <button class="btn btn-small" onclick="toggleSyncBar()">âœ•</button>
        </div>
    </div>

    <!-- Hauptcontainer der App -->
    <div class="container" id="appContainer">
        <header class="header">
            <div class="header-content">
                <div class="header-title-group">
                    <h1>ğŸš€ Web3 Portfolio Tracker Pro</h1>
                    <div class="subtitle">Advanced Portfolio Management mit Cloud Sync</div>
                </div>
                <div class="header-controls">
                    <div id="cloudStatusBadge" class="cloud-status-badge disconnected" onclick="openCloudSettings()">
                        <span id="cloudIcon">â˜ï¸</span>
                        <span id="cloudText">Offline</span>
                    </div>
                    <button class="theme-toggle" onclick="toggleTheme()" title="Theme wechseln (Ctrl+D)">ğŸŒ™</button>
                    <button class="btn btn-primary btn-small" onclick="toggleCompactMode()" title="Kompakte Ansicht">ğŸ“±</button>
                    <button class="btn btn-primary btn-small" onclick="toggleBiometric()" title="Alt+B">ğŸ” Bio Auth</button>
                    <button class="btn btn-danger btn-small" onclick="resetPlatforms()"><span>ğŸ”„</span> Reset</button>
                    <button class="btn btn-primary btn-small" onclick="exportPDF()"><span>ğŸ“„</span> PDF Export</button>
                </div>
            </div>
        </header>
        
        <div id="dateFilterBar" class="date-filter-bar">
            <div class="date-filter-header" onclick="toggleFilter()">
                <span class="filter-label">ğŸ—“ï¸ Zeitraum: <span id="activeFilterDisplay" style="color: var(--primary);">Alles</span></span>
                <span id="filterToggleArrow">â–¼</span>
            </div>
            <div class="date-filter-content">
                <div class="filter-presets">
                    <button class="filter-btn" onclick="setDateFilter('all')">Alles</button>
                    <button class="filter-btn" onclick="setDateFilter('7d')">7 Tage</button>
                    <button class="filter-btn" onclick="setDateFilter('30d')">30 Tage</button>
                    <button class="filter-btn" onclick="setDateFilter('90d')">90 Tage</button>
                    <button class="filter-btn" onclick="setDateFilter('ytd')">YTD</button>
                    <button class="filter-btn" onclick="setDateFilter('1y')">1 Jahr</button>
                </div>
                <div class="custom-date-range">
                    <div class="date-input-group">
                        <label for="filterStartDate">Von:</label>
                        <input type="date" id="filterStartDate" class="date-input-small">
                    </div>
                    <div class="date-input-group">
                        <label for="filterEndDate">Bis:</label>
                        <input type="date" id="filterEndDate" class="date-input-small">
                    </div>
                    <button class="btn btn-primary btn-small" onclick="applyAndSetCustomDateFilter()">Anwenden</button>
                    <button class="btn btn-danger btn-small" onclick="resetDateFilter()">ZurÃ¼cksetzen</button>
                </div>
            </div>
        </div>

        <nav class="tab-navigation">
            <button class="tab-btn active" onclick="switchTab('dashboard')" title="Alt+1">ğŸ“Š Dashboard</button>
            <button class="tab-btn" onclick="switchTab('entry')" title="Alt+2">ğŸ“ Neuer Eintrag</button>
            <button class="tab-btn" onclick="switchTab('cashflow')" title="Alt+3">ğŸ’¸ Cashflow</button>
            <button class="tab-btn" onclick="switchTab('platforms')" title="Alt+4">ğŸ’¼ Plattformen</button>
            <button class="tab-btn" onclick="switchTab('history')" title="Alt+5">ğŸ“œ Historie</button>
            <button class="tab-btn" onclick="switchTab('settings')" title="Alt+6">âš™ï¸ Einstellungen</button>
        </nav>

        <!-- Dashboard Tab -->
        <main id="dashboard" class="tab-content active">
            <div id="dashboard-content">
                <!-- Inhalt wird per JS geladen (Onboarding oder Stats) -->
            </div>
        </main>

        <!-- Neuer Eintrag Tab -->
        <main id="entry" class="tab-content">
            <section class="section">
                <div class="section-header">
                    <div class="section-title"><span>ğŸ“</span><span>Neuer Eintrag</span></div>
                    <div>
                        <button class="btn btn-success pulse" onclick="saveAllEntries()" title="Ctrl+S">
                            <span>ğŸ’¾</span><span>Alle Speichern</span>
                        </button>
                    </div>
                </div>
                
                <div class="date-range-selector">
                    <label style="font-weight: 600;">ğŸ“… Datum:</label>
                    <input type="date" id="entryDate" class="date-input">
                    <button class="btn btn-primary btn-small" onclick="setToToday()">Heute</button>
                    <button class="btn btn-primary btn-small" onclick="setToYesterday()">Gestern</button>
                    <button class="btn btn-primary btn-small" onclick="setToLastSunday()">Letzter So</button>
                    <button class="btn btn-primary btn-small" onclick="loadLastEntries()">Letzte EintrÃ¤ge laden</button>
                </div>

                <div style="margin-bottom: 24px;">
                    <h3 style="margin-bottom: 16px; color: var(--text-primary);">ğŸ¦„ Plattformen wÃ¤hlen:</h3>
                    
                    <div class="platform-search-container">
                        <input type="text" id="platformSearch" class="platform-search" placeholder="Plattform suchen... (Ctrl+F)" oninput="filterPlatforms()" onkeydown="handleSearchKeydown(event)">
                        <span class="search-icon">ğŸ”</span>
                        <div id="autocompleteDropdown" class="autocomplete-dropdown"></div>
                    </div>
                    
                    <div class="category-filter">
                        <button class="category-btn active" onclick="filterCategory(this, 'all')">Alle</button>
                        <button class="category-btn" onclick="filterCategory(this, 'favorites')">â­ Favoriten</button>
                        <button class="category-btn" onclick="filterCategory(this, 'Exchange')">Exchanges</button>
                        <button class="category-btn" onclick="filterCategory(this, 'DeFi')">DeFi</button>
                        <button class="category-btn" onclick="filterCategory(this, 'Lending')">Lending</button>
                        <button class="category-btn" onclick="filterCategory(this, 'Wallet')">Wallets</button>
                    </div>
                    
                    <div class="platform-grid" id="platformGrid"></div>
                </div>
                
                <div id="autoZeroHint" class="auto-zero-hint">
                    ğŸ’¡ <b>Tipp:</b> Wenn du jetzt speicherst, kannst du nicht ausgewÃ¤hlte Plattformen, die vorher Kapital hatten, automatisch auf 0 setzen.
                </div>

                <div id="platformInputs" class="input-grid"></div>
            </section>
        </main>

        <!-- Cashflow Tab -->
        <main id="cashflow" class="tab-content">
            <section class="section">
                <div class="section-header">
                    <div class="section-title"><span>ğŸ’¸</span><span>Cashflow Management</span></div>
                </div>
                
                <div class="cashflow-stats">
                    <div class="cashflow-stat">
                        <div class="cashflow-stat-label">â• Total Eingezahlt</div>
                        <div class="cashflow-stat-value positive" id="totalDeposits">$0</div>
                    </div>
                    <div class="cashflow-stat">
                        <div class="cashflow-stat-label">â– Total Ausgezahlt</div>
                        <div class="cashflow-stat-value negative" id="totalWithdrawals">$0</div>
                    </div>
                    <div class="cashflow-stat">
                        <div class="cashflow-stat-label">ğŸ’ Netto Investiert</div>
                        <div class="cashflow-stat-value" id="netCashflow">$0</div>
                    </div>
                    <div class="cashflow-stat">
                        <div class="cashflow-stat-label">ğŸ“Š ROI</div>
                        <div class="cashflow-stat-value" id="roiPercent">0%</div>
                    </div>
                </div>

                <div class="cashflow-form">
                    <div>
                        <label style="font-weight: 600; margin-bottom: 8px; display: block;">Typ:</label>
                        <div class="cashflow-type">
                            <label class="radio-option">
                                <input type="radio" name="cashflowType" value="deposit" checked>
                                <span>â• Einzahlung</span>
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="cashflowType" value="withdraw">
                                <span>â– Auszahlung</span>
                            </label>
                        </div>
                    </div>
                    <div>
                        <label style="font-weight: 600; margin-bottom: 8px; display: block;">Betrag (USD):</label>
                        <input type="text" id="cashflowAmount" class="input-field" placeholder="1000" inputmode="decimal">
                    </div>
                    <div>
                        <label style="font-weight: 600; margin-bottom: 8px; display: block;">Datum:</label>
                        <input type="date" id="cashflowDate" class="date-input">
                    </div>
                    <div id="cashflowTargetDiv">
                        <label style="font-weight: 600; margin-bottom: 8px; display: block;">Ziel-Plattform:</label>
                        <select id="cashflowTarget" class="input-field"></select>
                    </div>
                    <div>
                        <label style="font-weight: 600; margin-bottom: 8px; display: block;">Notiz:</label>
                        <input type="text" id="cashflowNote" class="input-field" placeholder="Optional...">
                    </div>
                    <div style="display: flex; align-items: flex-end;">
                        <button class="btn btn-success" onclick="saveCashflow()" title="Ctrl+S">
                            <span>ğŸ’¾</span><span>Speichern</span>
                        </button>
                    </div>
                </div>
            </section>

            <section class="section">
                <div class="section-header">
                    <div class="section-title"><span>ğŸ“œ</span><span>Cashflow Historie</span></div>
                </div>
                <div class="data-table-wrapper">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th class="sortable" data-sort="date">Datum <span class="sort-arrow"></span></th>
                                <th class="sortable" data-sort="type">Typ <span class="sort-arrow"></span></th>
                                <th class="sortable" data-sort="amount">Betrag <span class="sort-arrow"></span></th>
                                <th>Plattform</th>
                                <th>Notiz</th>
                                <th>Aktionen</th>
                            </tr>
                        </thead>
                        <tbody id="cashflowTableBody"></tbody>
                    </table>
                </div>
            </section>
        </main>

        <!-- Plattformen Tab -->
        <main id="platforms" class="tab-content">
            <section class="section">
                <div class="section-header">
                    <div class="section-title"><span>ğŸ’¼</span><span>Platform Details</span></div>
                    <div>
                        <input type="file" id="jsonFileInput" accept=".json" style="display: none;">
                        <input type="file" id="csvFileInput" accept=".csv" style="display: none;">
                        <button class="btn btn-primary btn-small" onclick="document.getElementById('jsonFileInput').click()">
                            <span>ğŸ“¥</span> Import JSON
                        </button>
                        <button class="btn btn-primary btn-small" onclick="document.getElementById('csvFileInput').click()">
                            <span>ğŸ“¤</span> Import CSV
                        </button>
                        <button class="btn btn-primary btn-small" onclick="exportCSV()" title="Ctrl+E">
                            <span>ğŸ“¥</span> Export CSV
                        </button>
                         <button class="btn btn-primary btn-small" onclick="exportJSON()">
                            <span>ğŸ’¾</span> Export JSON
                        </button>
                    </div>
                </div>
                <div class="data-table-wrapper">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th class="sortable" data-sort="platform">Plattform <span class="sort-arrow"></span></th>
                                <th class="sortable" data-sort="entries">EintrÃ¤ge <span class="sort-arrow"></span></th>
                                <th class="sortable" data-sort="first">Erster Eintrag <span class="sort-arrow"></span></th>
                                <th class="sortable" data-sort="last">Letzter Eintrag <span class="sort-arrow"></span></th>
                                <th class="sortable" data-sort="avg">Avg Balance <span class="sort-arrow"></span></th>
                                <th class="sortable" data-sort="total">Total Return <span class="sort-arrow"></span></th>
                            </tr>
                        </thead>
                        <tbody id="platformDetailsBody"></tbody>
                    </table>
                </div>
            </section>
        </main>

        <!-- Historie Tab -->
        <main id="history" class="tab-content">
            <section class="section">
                <div class="section-header">
                    <div class="section-title"><span>ğŸ“œ</span><span>Eintrags-Historie</span></div>
                    <div>
                        <input type="text" id="historySearch" class="input-field" placeholder="Suchen..." style="width: 200px;">
                        <button class="btn btn-danger btn-small" onclick="clearAllData()">
                            <span>ğŸ—‘ï¸</span> Alle LÃ¶schen
                        </button>
                    </div>
                </div>
                <div class="data-table-wrapper">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th><input type="checkbox" id="selectAllHistory" title="Alle auswÃ¤hlen"></th>
                                <th class="sortable" data-sort="date">Datum <span class="sort-arrow"></span></th>
                                <th class="sortable" data-sort="protocol">Plattform <span class="sort-arrow"></span></th>
                                <th class="sortable" data-sort="balance">Balance <span class="sort-arrow"></span></th>
                                <th>Notiz</th>
                                <th>Aktionen</th>
                            </tr>
                        </thead>
                        <tbody id="historyTableBody"></tbody>
                    </table>
                </div>
                 <div id="bulk-actions-footer" class="section-header" style="margin-top: 20px; border-top: 2px solid var(--border); padding-top: 20px; display: none;">
                    <div class="section-title"><span>ğŸ› ï¸</span><span id="bulk-actions-count"></span></div>
                    <div>
                        <button class="btn btn-primary btn-small" onclick="bulkEditDate()">Datum Ã¤ndern</button>
                        <button class="btn btn-danger" onclick="deleteSelectedEntries()">
                            <span>ğŸ—‘ï¸</span><span>Auswahl lÃ¶schen</span>
                        </button>
                    </div>
                </div>
            </section>
        </main>

        <!-- Einstellungen Tab -->
        <main id="settings" class="tab-content">
            <section class="section">
                <h2 style="margin-bottom: 20px;">â˜ï¸ Cloud Sync Einstellungen</h2>
                
                <div id="connectionStatus" class="connection-status disconnected">
                    <span>âš ï¸</span>
                    <span>Nicht verbunden - Konfiguriere GitHub fÃ¼r Cloud Sync</span>
                </div>

                <div class="info-box">
                    <h3>ğŸ“ Wie funktioniert der Cloud Sync?</h3>
                    <p>
                        Deine Daten werden in einem privaten GitHub Gist gespeichert. 
                        Nur du hast Zugriff darauf. Du benÃ¶tigst einen GitHub Account und ein Personal Access Token.
                    </p>
                </div>

                <div class="settings-grid">
                    <div class="setting-item">
                        <div class="setting-label">GitHub Token</div>
                        <div class="setting-value" id="tokenDisplay">Nicht konfiguriert</div>
                        <div class="setting-actions">
                            <button class="btn btn-primary btn-small" onclick="setupGitHubToken()">Token setzen</button>
                            <button class="btn btn-danger btn-small" onclick="clearGitHubToken()">LÃ¶schen</button>
                        </div>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-label">Gist ID</div>
                        <div class="setting-value" id="gistDisplay">Nicht konfiguriert</div>
                        <div class="setting-actions">
                            <button class="btn btn-primary btn-small" onclick="setupGistId()">Gist ID setzen</button>
                            <button class="btn btn-success btn-small" onclick="createNewGist()">Neu erstellen</button>
                             <button class="btn btn-danger btn-small" onclick="clearGistId()">LÃ¶schen</button>
                        </div>
                    </div>

                    <div class="setting-item">
                        <div class="setting-label">Auto-Sync</div>
                        <div class="setting-value">
                            <label style="display: flex; align-items: center; gap: 10px;">
                                <input type="checkbox" id="autoSyncToggle" onchange="toggleAutoSync()">
                                <span>Bei jeder Ã„nderung automatisch synchronisieren</span>
                            </label>
                        </div>
                    </div>

                    <div class="setting-item">
                        <div class="setting-label">Biometric Authentication</div>
                        <div class="setting-value">
                            <label style="display: flex; align-items: center; gap: 10px;">
                                <input type="checkbox" id="biometricToggle" onchange="toggleBiometric()">
                                <span>Fingerprint/Face ID beim Start aktivieren</span>
                            </label>
                        </div>
                    </div>

                    <div class="setting-item">
                        <div class="setting-label">Letzter Sync</div>
                        <div class="setting-value" id="lastSyncDisplay">Noch nie synchronisiert</div>
                        <div class="setting-actions">
                            <button class="btn btn-success btn-small" onclick="syncNow()">Jetzt synchronisieren</button>
                        </div>
                    </div>
                </div>

                <div style="margin-top: 30px; display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                    <button class="btn btn-primary" onclick="testConnection()">
                        <span>ğŸ”Œ</span><span>Verbindung testen</span>
                    </button>
                </div>
            </section>
        </main>
        
    </div>
    
    <!-- Modals -->
    <div id="promptModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="promptModalTitle" class="modal-title">Titel</h2>
            </div>
            <div class="modal-body">
                <p id="promptModalText"></p>
                <div id="promptModalListContainer"></div>
                <input type="text" id="promptModalInput" class="input-field" style="width: 100%; margin-top: 15px; display: none;">
            </div>
            <div class="modal-footer">
                <button id="promptModalCancel" class="btn btn-danger">Abbrechen</button>
                <button id="promptModalOk" class="btn btn-success" style="margin-left: 10px;">OK</button>
            </div>
        </div>
    </div>

    <div id="githubSetupModal" class="github-setup-modal">
        <div class="github-setup-content">
            <div class="github-setup-header">
                <div class="github-setup-title" id="mainModalTitle"></div>
            </div>
            <div id="mainModalBody"></div>
            <div class="github-setup-actions">
                <button class="btn btn-danger" onclick="closeMainModal()">Abbrechen</button>
                <button class="btn btn-success" id="mainModalSaveBtn">Speichern</button>
            </div>
        </div>
    </div>
    
    <!-- Benachrichtigung -->
    <div id="notification" class="notification">
        <span id="notificationIcon">âœ…</span>
        <span id="notificationText">Gespeichert!</span>
    </div>
    
    <!-- Mobile Enhancements -->
    <div id="pullToRefresh" class="pull-to-refresh">
        <span>â†»</span>
    </div>
    
    <div id="swipeIndicator" class="swipe-indicator">
        <span id="swipeText">Dashboard</span>
    </div>

    <!-- Verweis auf die JavaScript-Datei -->
    <script src="script.js" defer></script>
</body>
</html>
