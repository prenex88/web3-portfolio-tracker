<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web3 Portfolio Tracker Pro - Cloud Edition</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#6366f1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    <link rel="icon" href="icon.svg" type="image/svg+xml">
    <link rel="stylesheet" href="style.css">
    <style>
        /* Verhindert, dass der Browser scrollt, wÃ¤hrend wir das Bottom Sheet ziehen. */
        .bottom-sheet-header {
            touch-action: none;
        }
    </style>
</head>
<body>

    <div id="biometricOverlay" class="biometric-overlay">
        <div class="biometric-content">
            <div class="biometric-icon">ğŸ”</div>
            <div class="biometric-text">Portfolio Tracker entsperren</div>
            <div class="biometric-subtitle">Verwenden Sie Ihren Fingerabdruck oder Face ID</div>
            <button class="biometric-fallback" onclick="bypassBiometric()">
                Ohne Authentifizierung fortfahren
            </button>
        </div>
    </div>

    <div id="syncStatusBar" class="sync-status-bar">
        <div class="sync-status">
            <div id="syncIndicator" class="sync-indicator offline"></div>
            <span id="syncStatusText">Offline Modus</span>
            <span id="lastSyncTime" style="color: var(--text-secondary); font-size: 12px;"></span>
        </div>
        <div class="sync-actions">
            <button id="syncNowBtn" class="btn btn-primary btn-small" onclick="syncNow()">
                <span id="syncBtnIcon">â˜ï¸</span>
                <span id="syncBtnText">Sync</span>
            </button>
            <button class="btn btn-small" onclick="toggleSyncBar()">âœ•</button>
        </div>
    </div>

    <div class="container" id="appContainer">
        <div class="header">
            <div class="header-content">
                <div class="header-title-group" onclick="switchTab('dashboard')" style="cursor: pointer;" title="Zum Dashboard">
                    <h1>ğŸš€ Web3 Portfolio Tracker Pro</h1>
                    <div class="subtitle">Advanced Portfolio Management mit Cloud Sync</div>
                </div>
                <div class="header-controls">
                <button id="globalSearchBtn" class="btn-icon" title="Globale Suche (Ctrl+K)">ğŸ”</button>
                <button class="theme-toggle btn-icon" onclick="toggleTheme()" title="Theme wechseln (Ctrl+D)">ğŸŒ™</button>
                
                <!-- Dropdown MenÃ¼ -->
                <div class="header-menu-dropdown">
                    <button class="btn-icon" onclick="toggleHeaderMenu()" title="Mehr Optionen">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <circle cx="12" cy="5" r="2"/><circle cx="12" cy="12" r="2"/><circle cx="12" cy="19" r="2"/>
                        </svg>
                    </button>
                    <div id="headerDropdown" class="dropdown-content">
                        <button class="dropdown-item-flex" onclick="openCloudSettings(); toggleHeaderMenu();">
                            <span class="item-icon" id="cloudIcon">ğŸ”Œ</span>
                            <span class="item-text" id="cloudText">Offline</span>
                            <span id="cloudStatusIndicator" class="status-indicator disconnected"></span>
                        </button>
                        <button class="dropdown-item-flex" onclick="openDateFilterModal(); toggleHeaderMenu();">
                            <span class="item-icon">ğŸ—“ï¸</span>
                            <span class="item-text">Zeitraum filtern</span>
                            <span id="activeFilterBadge" class="status-indicator-badge"></span>
                        </button>
                        <div class="dropdown-divider"></div>
                        <button onclick="togglePrivacyMode(); toggleHeaderMenu();">ğŸ‘ï¸ PrivatsphÃ¤re-Modus</button>
                        <button onclick="toggleCompactMode(); toggleHeaderMenu();">ğŸ“± Kompakte Ansicht</button>
                        <button onclick="toggleBiometric(); toggleHeaderMenu();">ğŸ” Bio Auth</button>
                        <button onclick="exportPDF(); toggleHeaderMenu();">ğŸ“„ PDF Export</button>
                        <button onclick="exportJSON(); toggleHeaderMenu();">ğŸ’¾ JSON Backup</button>
                        <button onclick="exportCSV(); toggleHeaderMenu();">ğŸ“Š CSV Export</button>
                        <div class="dropdown-divider"></div>
                        <button onclick="switchTab('settings'); toggleHeaderMenu();">âš™ï¸ Einstellungen</button>
                    </div>
                </div>
                </div>
            </div>
        </div>

        <div class="tab-navigation">
            <button class="tab-btn active" onclick="switchTab('dashboard')" title="Alt+1" data-tab="dashboard">ğŸ“Š Dashboard</button>
            <button class="tab-btn" onclick="switchTab('entry')" title="Alt+2" data-tab="entry">ğŸ“ Neuer Eintrag</button>
            <button class="tab-btn" onclick="switchTab('cashflow')" title="Alt+3" data-tab="cashflow">ğŸ’¸ Cashflow</button>
            <button class="tab-btn" onclick="switchTab('platforms')" title="Alt+4" data-tab="platforms">ğŸ’¼ Plattformen</button>
            <button class="tab-btn" onclick="switchTab('history')" title="Alt+5" data-tab="history">ğŸ“œ Historie</button>
            <button class="tab-btn" onclick="switchTab('settings')" title="Alt+6" data-tab="settings">âš™ï¸ Einstellungen</button>
        </div>

        <!-- Versteckte Inputs fÃ¼r den Filter-Status -->
        <input type="hidden" id="filterStartDate">
        <input type="hidden" id="filterEndDate">

        <div id="dashboard" class="tab-content active">
            <div id="welcomeCard" class="section" style="display: none; text-align: center;">
                <div style="font-size: 48px; margin-bottom: 16px;">ğŸ‘‹</div>
                <h2 class="section-title" style="justify-content: center; margin-bottom: 16px;">Willkommen beim Portfolio Tracker!</h2>
                <p style="color: var(--text-secondary); margin-bottom: 24px;">Es sieht so aus, als hÃ¤ttest du noch keine Daten eingegeben. Starte jetzt mit deinem ersten Eintrag!</p>
                <button class="btn btn-success" onclick="switchTab('entry')">
                    <span>ğŸ“</span><span>Ersten Eintrag erstellen</span>
                </button>
            </div>

            <div id="dashboardContent">
                <div class="stats-grid" id="stats-widget">
                    <div class="stat-card">
                        <div class="stat-card-skeleton"></div>
                        <div class="stat-content">
                            <div class="stat-icon">ğŸ’°</div>
                            <div class="stat-label">Portfolio Gesamtwert</div>
                            <div class="stat-value dollar-value" id="totalValue">$0</div>
                            <div class="stat-change" id="totalChange">
                                <span>ğŸ“Š</span>
                                <span id="totalChangeValue" class="dollar-value"></span>
                                <span id="totalChangePercent"></span>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-skeleton"></div>
                        <div class="stat-content">
                            <div class="stat-icon">âš¡</div>
                            <div class="stat-label">LETZTE VERÃ„NDERUNG</div>
                            <div class="stat-value" id="dailyChangePercent">-</div>
                            <div class="stat-change" id="dailyChangeAmount">
                                <span>ğŸ’µ</span>
                                <span id="dailyChangeValue" class="dollar-value">-</span>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-skeleton"></div>
                        <div class="stat-content">
                            <div class="stat-icon">ğŸ’</div>
                            <div class="stat-label">Netto Investiert (Zeitraum)</div>
                            <div class="stat-value dollar-value" id="netInvested">$0</div>
                            <div class="stat-change">
                                <span>ğŸ’³</span>
                                <span id="netInvestedChange" class="dollar-value">Ein: $0 | Aus: $0</span>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-skeleton"></div>
                        <div class="stat-content">
                            <div class="stat-icon">ğŸ†</div>
                            <div class="stat-label">Reale Performance (Zeitraum)</div>
                            <div class="stat-value dollar-value" id="totalProfit">$0</div>
                            <div class="stat-change">
                                <span>ğŸ“Š</span>
                                <span id="profitPercent">0%</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="section" id="portfolio-chart-widget">
                    <div class="section-header">
                        <div class="section-title"><span>ğŸ“ˆ</span><span>Portfolio Entwicklung</span></div>
                        <div class="chart-controls">
                            <button class="chart-timeframe-btn" onclick="setDateFilter('30d')">1M</button>
                            <button class="chart-timeframe-btn" onclick="setDateFilter('90d')">3M</button>
                            <button class="chart-timeframe-btn" onclick="setDateFilter('ytd')">YTD</button>
                            <button class="chart-timeframe-btn" onclick="setDateFilter('1y')">1J</button>
                            <button class="chart-timeframe-btn active" onclick="setDateFilter('all')">MAX</button>
                        </div>
                        <button class="btn btn-primary btn-small" onclick="exportChart('portfolioChartContainer')" title="Ctrl+E">ğŸ“· Export</button>
                    </div>
                    <div class="chart-container" id="portfolioChartContainer">
                         <div class="chart-skeleton"></div>
                        <canvas id="portfolioChart"></canvas>
                    </div>
                    <div id="chart-performance-legend" class="chart-performance-legend"></div>
                </div>
                
                <div class="two-column-layout" id="details-widgets">
                    <div class="section">
                        <div class="section-header">
                            <div class="section-title"><span>â„¹ï¸</span><span>Portfolio-Analyse</span></div>
                        </div>
                        <div id="keyMetrics" class="metrics-grid">
                            <div id="keyMetrics" class="metrics-grid">
                                <div class="metric-item">
                                    <span class="metric-label">Start</span>
                                    <span class="metric-value" id="metricStartDate">-</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Laufzeit</span>
                                    <span class="metric-value" id="metricDuration">-</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Startkapital</span>
                                    <span class="metric-value dollar-value" id="metricStartCapital">-</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Rendite (Gesamt)</span>
                                    <span class="metric-value" id="metricTotalReturnPercent">-</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Rendite Summe</span>
                                    <span class="metric-value dollar-value" id="metricTotalReturnSum">-</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Rendite Ã˜ (Monat)</span>
                                    <span class="metric-value" id="metricAvgMonthlyReturn">-</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Rendite Prognose (Jahr)</span>
                                    <span class="metric-value" id="metricAnnualForecast">-</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Max. Drawdown</span>
                                    <span class="metric-value" id="metricMaxDrawdown">-</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Portfolio Prognose (Jahr)</span>
                                    <span class="metric-value dollar-value" id="metricPortfolioForecast">-</span>
                                </div>
                            </div>
                        </div>
                    </div>
                     <div class="section">
                        <div class="section-header">
                            <div class="section-title"><span>ğŸ°</span><span>Portfolio-Verteilung</span></div>
                             <button class="btn btn-primary btn-small" onclick="exportChart('allocationChartContainer')" title="Ctrl+E">ğŸ“· Export</button>
                        </div>
                        <div class="chart-container" id="allocationChartContainer">
                            <div class="chart-skeleton"></div>
                            <canvas id="allocationChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="entry" class="tab-content">
             <div class="section">
                <div class="section-header">
                    <div class="section-title"><span>ğŸ“</span><span>Neuer Eintrag</span></div>
                    <div>
                        <button class="btn btn-success pulse" onclick="saveAllEntries()" title="Ctrl+S">
                            <span>ğŸ’¾</span><span>Alle Speichern</span>
                        </button>
                    </div>
                </div>
                
                <div class="date-range-selector">
                    <label style="font-weight: 600;">ğŸ“… Datum:</label>
                    <input type="date" id="entryDate" class="date-input">
                    <button class="btn btn-primary btn-small" onclick="setToToday()">Heute</button>
                    <button class="btn btn-primary btn-small" onclick="setToYesterday()">Gestern</button>
                    <button class="btn btn-primary btn-small" onclick="loadLastEntries()">Letzte EintrÃ¤ge laden</button>
                </div>

                <div style="margin-bottom: 24px;">
                    <h3 style="margin-bottom: 16px; color: var(--text-primary);">â­ Favoriten-Zone</h3>
                    <p style="color: var(--text-secondary); font-size: 14px; margin-top: -12px; margin-bottom: 16px;">Plattformen hierher ziehen, um sie als Favorit zu markieren.</p>
                    <div id="favoritesGrid" class="platform-grid favorites-zone"></div>
                    
                    <div class="platform-search-container" style="margin-top: 24px;">
                        <input type="text" id="platformSearch" class="platform-search" placeholder="Plattform suchen... (Ctrl+F)" oninput="filterPlatforms()" onkeydown="handleSearchKeydown(event)">
                        <span class="search-icon">ğŸ”</span>
                        <div id="autocompleteDropdown" class="autocomplete-dropdown"></div>
                    </div>
                    
                    <details style="margin-top: 16px;">
                        <summary class="section-header-summary">
                            <div class="section-title"><span>ğŸ¦„</span><span>Alle Plattformen</span></div>
                            <span class="summary-arrow">â–¼</span>
                        </summary>
                        <div class="details-content" style="padding-top: 16px;">
                            <div class="category-filter">
                                <button class="category-btn active" onclick="filterCategory(this, 'all')">Alle</button>
                                <button class="category-btn" onclick="filterCategory(this, 'Exchange')">Exchanges</button>
                                <button class="category-btn" onclick="filterCategory(this, 'DeFi')">DeFi</button>
                                <button class="category-btn" onclick="filterCategory(this, 'Lending')">Lending</button>
                                <button class="category-btn" onclick="filterCategory(this, 'Wallet')">Wallets</button>
                            </div>
                            
                            <div class="platform-grid" id="platformGrid"></div>
                        </div>
                    </details>
                </div>
                
                <div id="autoZeroHint" class="auto-zero-hint">
                    ğŸ’¡ <b>Tipp:</b> Wenn du jetzt speicherst, kannst du nicht ausgewÃ¤hlte Plattformen, die vorher Kapital hatten, automatisch auf 0 setzen.
                </div>
                
                <div id="dayStrategyContainer" class="day-strategy-container" style="display: none; margin-bottom: 24px;">
                    <div class="strategy-input-row">
                        <label class="strategy-label">ğŸ“‹ Tages-Strategie:</label>
                        <div style="display: flex; gap: 8px;">
                            <input type="text" id="dailyStrategy" class="strategy-input"
                                   placeholder="z.B. Abgesichertes Liquidity Providing, Funding Rate Farming..."
                                   onkeydown="if(event.key === 'Enter') { event.preventDefault(); saveStrategyOnly(); }">
                            <button class="btn btn-primary btn-small" onclick="saveStrategyOnly()">
                                ğŸ’¾ Speichern
                            </button>
                        </div>
                    </div>
                </div>

                <div id="platformInputs" class="input-grid"></div>
            </div>
        </div>

        <div id="cashflow" class="tab-content">
            <div class="section">
                <div class="section-header">
                    <div class="section-title"><span>ğŸ’¸</span><span>Cashflow Management</span></div>
                </div>
                
                <div class="cashflow-stats">
                    <div class="cashflow-stat">
                        <div class="cashflow-stat-label">â• Total Eingezahlt</div>
                        <div class="cashflow-stat-value positive dollar-value" id="totalDeposits">$0</div>
                    </div>
                    <div class="cashflow-stat">
                        <div class="cashflow-stat-label">â– Total Ausgezahlt</div>
                        <div class="cashflow-stat-value negative dollar-value" id="totalWithdrawals">$0</div>
                    </div>
                    <div class="cashflow-stat">
                        <div class="cashflow-stat-label">ğŸ’ Netto Investiert</div>
                        <div class="cashflow-stat-value dollar-value" id="netCashflow">$0</div>
                    </div>
                    <div class="cashflow-stat">
                        <div class="cashflow-stat-label">ğŸ“Š ROI</div>
                        <div class="cashflow-stat-value" id="roiPercent">0%</div>
                    </div>
                </div>

                <div class="cashflow-form">
                    <div>
                        <label style="font-weight: 600; margin-bottom: 8px; display: block;">Typ:</label>
                        <div class="cashflow-type">
                            <label class="radio-option">
                                <input type="radio" name="cashflowType" value="deposit" checked>
                                <span>â• Einzahlung</span>
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="cashflowType" value="withdraw">
                                <span>â– Auszahlung</span>
                            </label>
                        </div>
                    </div>
                    <div>
                        <label style="font-weight: 600; margin-bottom: 8px; display: block;">Betrag (USD):</label>
                        <input type="text" id="cashflowAmount" class="input-field" placeholder="1000" inputmode="decimal">
                    </div>
                    <div>
                        <label style="font-weight: 600; margin-bottom: 8px; display: block;">Datum:</label>
                        <input type="date" id="cashflowDate" class="date-input">
                    </div>
                    <div id="cashflowTargetDiv">
                        <label style="font-weight: 600; margin-bottom: 8px; display: block;">Ziel-Plattform:</label>
                        <select id="cashflowTarget" class="input-field"></select>
                    </div>
                    <div>
                        <label style="font-weight: 600; margin-bottom: 8px; display: block;">Notiz:</label>
                        <input type="text" id="cashflowNote" class="input-field" placeholder="Optional...">
                    </div>
                    <div style="display: flex; align-items: flex-end;">
                        <button class="btn btn-success" onclick="saveCashflow()" title="Ctrl+S">
                            <span>ğŸ’¾</span><span>Speichern</span>
                        </button>
                    </div>
                </div>
            </div>

            <div class="section">
                <div class="section-header">
                    <div class="section-title"><span>ğŸ“œ</span><span>Cashflow Historie</span></div>
                    <div class="view-switcher">
                        <button class="view-btn active" onclick="setCashflowView('list')">Liste</button>
                        <button class="view-btn" onclick="setCashflowView('month')">Monat</button>
                        <button class="view-btn" onclick="setCashflowView('quarter')">Quartal</button>
                    </div>
                </div>
                <div id="cashflowDisplayContainer" class="cashflow-display-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th class="sortable" data-sort="date">Datum <span class="sort-arrow"></span></th>
                                <th class="sortable" data-sort="type">Typ <span class="sort-arrow"></span></th>
                                <th class="sortable" data-sort="amount">Betrag <span class="sort-arrow"></span></th>
                                <th class="sortable" data-sort="platform">Plattform <span class="sort-arrow"></span></th>
                                <th class="sortable" data-sort="note">Notiz <span class="sort-arrow"></span></th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody id="cashflowTableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="platforms" class="tab-content">
             <div class="section">
                <div class="section-header">
                    <div class="section-title"><span>ğŸ’¼</span><span>Platform Details</span></div>
                </div>
                <div class="data-table-wrapper">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th class="sortable" data-sort="platform">Plattform <span class="sort-arrow"></span></th>
                                <th class="sortable" data-sort="entries">EintrÃ¤ge <span class="sort-arrow"></span></th>
                                <th class="sortable" data-sort="first">Erster Eintrag <span class="sort-arrow"></span></th>
                                <th class="sortable" data-sort="last">Letzter Eintrag <span class="sort-arrow"></span></th>
                                <th class="sortable" data-sort="avg">Avg Balance <span class="sort-arrow"></span></th>
                                <th class="sortable" data-sort="total">Total Return <span class="sort-arrow"></span></th>
                            </tr>
                        </thead>
                        <tbody id="platformDetailsBody"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="history" class="tab-content">
            <div class="section">
                <div class="section-header">
                    <div class="section-title"><span>ğŸ“œ</span><span>Eintrags-Historie</span></div>
                    <div class="view-switcher">
                        <button class="view-btn active" onclick="setHistoryView('list')">Liste</button>
                        <button class="view-btn" onclick="setHistoryView('grouped')">Gruppiert</button>
                    </div>
                    <input type="text" id="historySearch" class="input-field" placeholder="In Liste suchen..." style="width: 200px;">
                </div>
                <div id="historyListView">
                    <div class="data-table-wrapper">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th><input type="checkbox" id="selectAllHistory" title="Alle auswÃ¤hlen"></th>
                                    <th class="sortable" data-sort="date">Datum <span class="sort-arrow"></span></th>
                                    <th class="sortable" data-sort="protocol">Plattform <span class="sort-arrow"></span></th>
                                    <th class="sortable" data-sort="balance">Balance <span class="sort-arrow"></span></th>
                                    <th class="sortable" data-sort="strategy">Strategie <span class="sort-arrow"></span></th>
                                    <th>Notiz</th>
                                    <th>Aktionen</th>
                                </tr>
                            </thead>
                            <tbody id="historyTableBody"></tbody>
                        </table>
                    </div>
                </div>
                <div id="historyMobileCards" class="mobile-cards">
                    <!-- Mobile card layout wird hier von JavaScript eingefÃ¼gt -->
                </div>
                <div id="historyBulkActions" class="bulk-actions-bar">
                    <span id="bulkSelectedCount">0 EintrÃ¤ge ausgewÃ¤hlt</span>
                    <div class="bulk-actions-buttons">
                        <button class="btn btn-primary btn-small" onclick="bulkChangeDate()">
                            <span>ğŸ—“ï¸</span> Datum Ã¤ndern
                        </button>
                        <button class="btn btn-primary btn-small" onclick="bulkChangeAmount()">
                            <span>ğŸ’°</span> Betrag Ã¤ndern
                        </button>
                        <button class="btn btn-danger btn-small" onclick="deleteSelectedEntries()">
                            <span>ğŸ—‘ï¸</span> Auswahl lÃ¶schen
                        </button>
                    </div>
                </div>
                <div id="historyGroupedView" style="display: none;">
                    <!-- Gruppierte Ansicht wird hier von JavaScript eingefÃ¼gt -->
                </div>
            </div>
        </div>

        <div id="settings" class="tab-content">
            <div class="section">
                <details open>
                    <summary class="section-header-summary">
                        <div class="section-title"><span>â˜ï¸</span><span>Cloud Sync Einstellungen</span></div>
                        <span class="summary-arrow">â–¼</span>
                    </summary>
                    <div class="details-content" style="padding-top: 16px;">
                        <div id="connectionStatus" class="connection-status disconnected">
                            <span>âš ï¸</span>
                            <span>Nicht verbunden - Konfiguriere GitHub fÃ¼r Cloud Sync</span>
                        </div>

                        <div class="info-box">
                            <h3>ğŸ“ Wie funktioniert der Cloud Sync?</h3>
                            <p>
                                Deine Daten werden in einem privaten GitHub Gist gespeichert. 
                                Nur du hast Zugriff darauf. Du benÃ¶tigst einen GitHub Account und ein Personal Access Token.
                            </p>
                        </div>

                        <div class="settings-grid">
                            <div class="setting-item">
                                <div class="setting-label">GitHub Token</div>
                                <div class="setting-value" id="tokenDisplay">Nicht konfiguriert</div>
                                <div class="setting-actions">
                                    <button class="btn btn-primary btn-small" onclick="setupGitHubToken()">Token setzen</button>
                                    <button class="btn btn-danger btn-small" onclick="clearGitHubToken()">LÃ¶schen</button>
                                </div>
                            </div>
                            
                            <div class="setting-item" style="display: none;">
                                <div class="setting-label">Gist ID</div>
                                <div class="setting-value" id="gistDisplay">Nicht konfiguriert</div>
                                <div class="setting-actions">
                                    <button class="btn btn-primary btn-small" onclick="setupGistId()">Gist ID setzen</button>
                                    <button class="btn btn-success btn-small" onclick="createNewGist()">Neu erstellen</button>
                                     <button class="btn btn-danger btn-small" onclick="clearGistId()">LÃ¶schen</button>
                                </div>
                            </div>

                            <div class="setting-item">
                                <div class="setting-label">Auto-Sync</div>
                                <div class="setting-value">
                                    <label style="display: flex; align-items: center; gap: 10px;">
                                        <input type="checkbox" id="autoSyncToggle" onchange="toggleAutoSync()">
                                        <span>Bei jeder Ã„nderung automatisch synchronisieren</span>
                                    </label>
                                </div>
                            </div>

                            <div class="setting-item">
                                <div class="setting-label">Letzter Sync</div>
                                <div class="setting-value" id="lastSyncDisplay">Noch nie synchronisiert</div>
                                <div class="setting-actions">
                                    <button class="btn btn-success btn-small" onclick="syncNow()">Jetzt synchronisieren</button>
                                </div>
                            </div>
                        </div>

                        <div style="margin-top: 30px; display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                            <button class="btn btn-primary" onclick="testConnection()">
                                <span>ğŸ”Œ</span><span>Verbindung testen</span>
                            </button>
                        </div>
                    </div>
                </details>
            </div>
            
            <div class="section">
                <details>
                    <summary class="section-header-summary">
                        <div class="section-title"><span>ğŸ’¾</span><span>Backup & Wiederherstellung</span></div>
                        <span class="summary-arrow">â–¼</span>
                    </summary>
                    <div class="details-content">
                        <div class="settings-grid" style="margin-top: 16px;">
                            <div class="setting-item">
                                <div class="setting-label">Lokales Backup</div>
                                <div class="setting-value">Stellt den Zustand vom letzten Speichern wieder her.</div>
                                <div class="setting-actions">
                                    <button class="btn btn-warning btn-small" onclick="restoreFromLocalBackup()">Aus lokalem Backup wiederherstellen</button>
                                </div>
                            </div>
                        </div>
                        <div class="info-box" style="margin-top: 24px;">
                            <h3>ğŸ’¡ Deine Backup-Strategie</h3>
                            <p>Deine Daten sind mehrfach gesichert:</p>
                            <ul>
                                <li><b>Lokal (Automatisch):</b> Bei jeder Speicherung wird ein Backup in der robusten IndexedDB deines Browsers angelegt. Dies dient als schnelle, lokale Absicherung.</li>
                                <li><b>Cloud (Empfohlen):</b> Die Synchronisierung mit GitHub (siehe oben) ist die sicherste Methode, um deine Daten gerÃ¤teÃ¼bergreifend zu sichern und wiederherzustellen.</li>
                                <li><b>Manuell (Export):</b> Du kannst deine Daten jederzeit als JSON- oder CSV-Datei exportieren und an einem sicheren Ort speichern.</li>
                            </ul>
                        </div>
                    </div>
                </details>
            </div>
            
            <!-- Ansicht & Bedienung Section -->
            <div class="section">
                <details>
                    <summary class="section-header-summary">
                        <div class="section-title"><span>ğŸ¨</span><span>Ansicht & Bedienung</span></div>
                        <span class="summary-arrow">â–¼</span>
                    </summary>
                    <div class="details-content">
                        <div class="settings-grid" style="margin-top: 16px;">
                            <div class="setting-item">
                                <div class="setting-label">Kompakte Ansicht</div>
                                <div class="setting-value">
                                    <label style="display: flex; align-items: center; gap: 10px;">
                                        <input type="checkbox" id="compactModeToggle" onchange="toggleCompactMode()">
                                        <span>Optimiert fÃ¼r kleine Bildschirme</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </details>
            </div>

            <!-- Neue Section in Settings Tab -->
            <div class="section">
                <details>
                    <summary class="section-header-summary">
                        <div class="section-title"><span>ğŸ—‚ï¸</span><span>Daten Management</span></div>
                        <span class="summary-arrow">â–¼</span>
                    </summary>
                    <div class="details-content">
                        <div class="settings-grid" style="margin-top: 16px;">
                            <div class="setting-item">
                                <div class="setting-label">ğŸ“¤ Export Optionen</div>
                                <div class="setting-value">Sichere deine Daten in verschiedenen Formaten</div>
                                <div class="setting-actions">
                                    <button class="btn btn-primary btn-small" onclick="exportJSON()">JSON</button>
                                    <button class="btn btn-primary btn-small" onclick="exportCSV()">CSV</button>
                                    <button class="btn btn-primary btn-small" onclick="exportPDF()">PDF</button>
                                </div>
                            </div>
                            
                            <div class="setting-item">
                                <div class="setting-label">ğŸ“¥ Import</div>
                                <div class="setting-value">Lade bestehende Daten</div>
                                <div class="setting-actions">
                                    <input type="file" id="jsonFileInput" accept=".json" style="display: none;">
                                    <input type="file" id="csvFileInput" accept=".csv" style="display: none;">
                                    <button class="btn btn-primary btn-small" onclick="document.getElementById('jsonFileInput').click()">JSON</button>
                                    <button class="btn btn-primary btn-small" onclick="document.getElementById('csvFileInput').click()">CSV</button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Danger Zone -->
                        <div class="danger-zone">
                            <h3>âš ï¸ Gefahrenbereich</h3>
                            <p>Diese Aktionen kÃ¶nnen nicht rÃ¼ckgÃ¤ngig gemacht werden!</p>
                            <div class="danger-actions">
                                <button class="btn btn-danger" onclick="resetPlatforms()">ğŸ”„ Plattformen zurÃ¼cksetzen</button>
                                <button class="btn btn-danger" onclick="clearAllData()">ğŸ—‘ï¸ Alle Daten lÃ¶schen</button>
                            </div>
                        </div>
                    </div>
                </details>
            </div>
        </div>
    </div>
    
    <div id="bottomSheet" class="bottom-sheet-overlay">
        <div class="bottom-sheet-content">
            <div class="bottom-sheet-header">
                <div class="bottom-sheet-drag-handle"></div>
            </div>
            <div id="bottomSheetBody" class="bottom-sheet-body">
                </div>
        </div>
    </div>

    <div id="notification" class="notification">
        <span id="notificationIcon">âœ…</span>
        <span id="notificationText">Gespeichert!</span>
    </div>

    <!-- Globale Suche Modal -->
    <div id="globalSearchOverlay" class="global-search-overlay">
        <div id="globalSearchModal" class="global-search-modal">
            <div class="search-input-wrapper">
                <input type="text" id="globalSearchInput" placeholder="Suche nach Plattformen, EintrÃ¤gen, Aktionen...">
                <button class="btn btn-small" onclick="exportSearchResults()" title="Suchergebnisse exportieren">ğŸ’¾</button>
                <span class="search-modal-close" onclick="closeGlobalSearch()">âœ•</span>
            </div>
            <div id="searchFilters" class="search-filters" style="display: none;">
                <!-- Filter werden hier dynamisch eingefÃ¼gt -->
            </div>
            <div class="search-quick-filters">
                <button class="btn btn-small" onclick="setDateRangeFilter('heute')">ğŸ“… Heute</button>
                <button class="btn btn-small" onclick="setDateRangeFilter('woche')">ğŸ“… Diese Woche</button>
                <button class="btn btn-small" onclick="setDateRangeFilter('monat')">ğŸ“… Dieser Monat</button>
                <button class="btn btn-small" onclick="toggleSearchFilter('category', 'Exchange')">ğŸ¦ Exchange</button>
                <button class="btn btn-small" onclick="toggleSearchFilter('category', 'DeFi')">ğŸ”„ DeFi</button>
                <button class="btn btn-small" onclick="toggleSearchFilter('tag', 'high-risk')">âš ï¸ High-Risk</button>
            </div>
            <div id="globalSearchResults" class="global-search-results">
                <!-- Ergebnisse werden hier dynamisch eingefÃ¼gt -->
            </div>
        </div>
    </div>

    <!-- Mobile Bottom Navigation -->
    <nav class="mobile-bottom-nav" id="mobileBottomNav">
        <button class="mobile-nav-item active" onclick="switchTab('dashboard')" data-tab="dashboard">
            <span class="nav-icon">ğŸ“Š</span>
            <span class="nav-label">Dashboard</span>
        </button>
        <button class="mobile-nav-item" onclick="switchTab('entry')" data-tab="entry">
            <span class="nav-icon">ğŸ“</span>
            <span class="nav-label">Eintrag</span>
        </button>
        <button class="mobile-nav-item" onclick="switchTab('cashflow')" data-tab="cashflow">
            <span class="nav-icon">ğŸ’¸</span>
            <span class="nav-label">Cashflow</span>
        </button>
        <button class="mobile-nav-item" onclick="switchTab('history')" data-tab="history">
            <span class="nav-icon">ğŸ“œ</span>
            <span class="nav-label">Historie</span>
        </button>
    </nav>

    <script src="script.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- Bottom Sheet Swipe-Logik ---
        const bottomSheetOverlay = document.getElementById('bottomSheet');
        const bottomSheetContent = bottomSheetOverlay.querySelector('.bottom-sheet-content');
        const bottomSheetHeader = bottomSheetOverlay.querySelector('.bottom-sheet-header');
        
        let bsTouchStartY = 0;
        let bsCurrentTranslateY = 0;

        if (bottomSheetHeader && bottomSheetContent) {
            bottomSheetHeader.addEventListener('touchstart', (e) => {
                bsTouchStartY = e.touches[0].clientY;
                bottomSheetContent.style.transition = 'none'; // Deaktiviert die CSS-Transition wÃ¤hrend des Ziehens
            }, { passive: true });

            bottomSheetHeader.addEventListener('touchmove', (e) => {
                const touchY = e.touches[0].clientY;
                const deltaY = touchY - bsTouchStartY;
                
                if (deltaY > 0) { // Nur nach unten ziehen erlauben
                    bsCurrentTranslateY = deltaY;
                    bottomSheetContent.style.transform = `translateY(${bsCurrentTranslateY}px)`;
                }
            });

            bottomSheetHeader.addEventListener('touchend', () => {
                if (bsCurrentTranslateY === 0) return;

                bottomSheetContent.style.transition = 'transform 0.3s ease-out';
                const sheetHeight = bottomSheetContent.offsetHeight;

                // Wenn mehr als 1/4 nach unten gezogen, schlieÃŸen
                if (bsCurrentTranslateY > sheetHeight / 4) {
                    // Da wir die genaue SchlieÃŸfunktion nicht kennen, verstecken wir das Element.
                    // Dies ist eine sichere Methode, die in den meisten FÃ¤llen funktionieren sollte.
                    // Idealerweise gÃ¤be es eine Funktion wie `closeBottomSheet()`, die hier aufgerufen wird.
                    bottomSheetOverlay.style.display = 'none';
                    // Transform zurÃ¼cksetzen fÃ¼r das nÃ¤chste Ã–ffnen
                    bottomSheetContent.style.transform = 'translateY(0)';
                } else {
                    // ZurÃ¼ck zur Ausgangsposition schnappen
                    bottomSheetContent.style.transform = 'translateY(0)';
                }

                bsCurrentTranslateY = 0;
                bsTouchStartY = 0;
            });
        }
    });
    </script>
</body>
</html>